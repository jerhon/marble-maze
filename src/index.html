<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Sample Project</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta http-equiv="cleartype" content="on">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="style.css" >
    <link rel="icon" type="image/png" href="assets/icon.png" >
    <style>
      html,
      body,
      canvas {
        margin: 0 !important;
        padding: 0 !important;
        overflow: hidden !important;
      }
    </style>
    <script src="vendors.app.bundle.js"></script>
    <script src="app.bundle.js"></script>
  </head>
  <body>
    <div id="game"></div>
    <div id="install-required" style="padding: 40px;">
      <div>
      This application is meant to be played as a phone app.  To install, click the button below.
      </div>

      <div style="padding: 20px;">
        <button id="install-pwa">
          Install Marble Maze
        </button>
      </div>
      <div id="already-installed" hidden="true">
        The application is already installed, please run from your phone.
      </div>
    </div>
    <script type="text/javascript">
    
      let deferredPrompt;
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js').then(registration => {
                console.log('SW registered: ', registration);
            }).catch(registrationError => {
                console.log('SW registration failed: ', registrationError);
            });
        });

        if (window.location.href.indexOf('source=pwa') >= 0) { 
          game.runGame();
        } else {
          document.getElementById('game').hidden = true;
          document.getElementById('install-required').hidden = false;

          window.addEventListener('beforeinstallprompt', (e) => {
            console.log('before install!');
            // Stash the event so it can be triggered later.
            e.preventDefault();
            deferredPrompt = e;
            
          });
          document.getElementById('install-pwa').addEventListener('click', () => {
            console.log('install!');
            if (deferredPrompt) {
              deferredPrompt.prompt();
            } else {
              document.getElementById('already-installed').hidden = false;
            }
          });
        }
      } else {

      }
    </script>
  </body>
</html>