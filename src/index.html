<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Sample Project</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta http-equiv="cleartype" content="on">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="style.css" >
    <link rel="icon" type="image/png" href="assets/icon.png" >
    <style>
      html,
      body,
      canvas {
        margin: 0 !important;
        padding: 0 !important;
        overflow: hidden !important;
      }
    </style>
    <script src="vendors.app.bundle.js"></script>
    <script src="app.bundle.js"></script>
  </head>
  <body>
    <div id="game"></div>
    <div id="install-required" style="padding: 40px;">
      <h1>Marble Maze</h1>
      <p>&copy; 2019 Jeremy Honl</p>
      <p>See the source on <a href="https://github.com/jerhon/marble-maze">GitHub</a></p>
      <div class="section">
        This application is meant to be played as a phone app.  To install, click the button below after agreeing to the terms.
      </div>

      <div class="section">
        <p>
          <a href="/LICENSE.txt">License Terms</a>
        </p>
        <p>
          <input id="license" type="checkbox" onchange="onLicenseAgreed(this.checked)" />
          <label for="license">I agree to the License Terms.</label>
        </p>
        <button id="install-pwa" disabled="true" >
          Install Marble Maze
        </button>
      </div>
    </div>
    <script type="text/javascript">
    
      function runNormal() {
        game.runGame();
      }
      function runInstall() {
        document.getElementById('game').hidden = true;
          document.getElementById('install-required').hidden = false;

          window.addEventListener('beforeinstallprompt', (e) => {
            console.log('before install!');
            // Stash the event so it can be triggered later.
            e.preventDefault();
            deferredPrompt = e;
            
          });
          document.getElementById('install-pwa').addEventListener('click', () => {
            
            if (deferredPrompt) {
              deferredPrompt.prompt();
            } else {
              alert("The application is already installed, or your phone does not support running the application");
            }
          });
      }
      function onLicenseAgreed(checked) {
        document.getElementById("install-pwa").disabled = !checked;
      }

      let deferredPrompt;
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js').then(registration => {
                console.log('SW registered: ', registration);
            }).catch(registrationError => {
                console.log('SW registration failed: ', registrationError);
            });
        });

        if (window.location.href.indexOf('source=pwa') >= 0) { 
          runNormal();
        } else {
          runInstall();
        }
      } else {

      }
    </script>
  </body>
</html>